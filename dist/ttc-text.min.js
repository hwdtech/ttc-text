!function(a,b){"object"==typeof exports?module.exports=b(require("lodash"),require("snowball"),require("moment")):"function"==typeof define&&define.amd?define("ttc-text",["lodash","snowball","moment"],b):a.ttc=b(a._,a.Snowball,a.moment)}(this,function(a,b,c){function d(a){return function(){if(Object.getPrototypeOf(this)!==a.prototype){var b=Object.create(a.prototype);return a.apply(b,arguments),b}return a.apply(this,arguments)}}function e(a){throw new Error("Undefined language: "+a)}function f(){var b={};b.en={abbr:"en"},this.set=function(c,d){return d.abbr=c,b[c]=b[c]||{},a.extend(b[c],d)},this.get=function(a){if(!b[a]&&T)try{require("./lang/"+a)}catch(c){e(a)}return b[a]}}function g(){}function h(a){return"function"==typeof String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function i(a){return a.replace(/([\-.*+?\^${}()|\[\]\/\\])/g,"\\$1")}function j(a){return h(a.replace(/[\.,\/#\?!$%\^&\*;:{}=\-_`~()](\s|$)/g," ").replace(/\s+/g," "))}function k(a){return a=h(a),a?j(a).split(" "):[]}function l(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/\{(\d+)\}/g,function(a,c){return b[c]})}function m(a){this._s=a||""}function n(a){var c,d=a;Object.defineProperty(this,"_s",{get:function(){return c=c||new b(d)}})}function o(b){this.originalValue=b,this.words=k(b),this.stems=O.stemmer().stem(this.words),this.labels=a.map(this.words,function(){return[]}),this.stemmedValue=this.stems.join(" ")}function p(a){return a=a||c(),[a.startOf("week").toDate(),a.endOf("week").toDate()]}function q(){}function r(b,c){return a.find(b,function(a){return 0===a.toLowerCase().indexOf(c.toLowerCase())})||null}function s(a,b){var d=r(c.weekdays(),a);return d?(b?c().subtract("days",7):c()).day(d).toDate():(d=r(O.fn._lang.relativeDays,a),O.langConf().relativeDay(d)||null)}function t(a,b,c,d,e){function f(a){var b=O.stemmer(),c="|";return b.stem(a.split(c)).join(c)}b=f(b),c=f(c),d=f(d);var g=P(a),h=new RegExp(l("(\\s|^)({0})\\s+({1})(\\s|$)",b,d),"i"),i=g.stemmedValue.match(h);return i?(g.labelBySubstr(i.index,i[0],!0),e(i[3])):(h=new RegExp(l("((\\s|^)({0})\\s)?\\s*({1})(\\s|$)",c,d),"i"),i=g.stemmedValue.match(h),i&&void 0===i[1]?(g.labelBySubstr(i.index,i[0],!0),e(i[4])):null)}function u(a,b,c,d){return t(a,b,c,O.stemmer().stem(d).join("|"),s)}function v(a){var b=O.langConf();return u(a,b.prefix.since+"|"+b.prefix.at,b.prefix.till,b.relativeDays)}function w(a){var b=O.langConf();return u(a,b.prefix.till+"|"+b.prefix.at,b.prefix.since,b.relativeDays)}function x(a,b,d){var e=O.langConf(),f=function(a){return c(a,"l").toDate()};return t(a,b,d,e.defaultDateRePattern,f)}function y(a){var b=O.langConf().prefix;return x(a,b.since+"|"+b.at,b.till)}function z(a){var b=O.langConf().prefix;return x(a,b.till+"|"+b.at,b.since)}function A(b,c,d,e,f){return e=a.map(e,function(a){return a.toLowerCase()}).join("|"),t(b,c,d,e,function(a){return s(a,f)})}function B(a,b){var d=O.langConf().prefix;return A(a,d.since+"|"+d.at,d.till,c.weekdays(),b)}function C(a,b){var d=O.langConf().prefix;return A(a,d.till+"|"+d.at,d.since,c.weekdays(),b)}function D(b,c){var d=O.li(b),e=O.langConf().ranges,f=null;return a.each(e,function(a,b){var e=d.originalValue.match(new RegExp(b,"i"));e&&null===f&&(d.labelBySubstr(e.index,e[0]),f=c?a()[0]:a()[1])}),f}function E(a,b,c){b=!!b;var d=b?y(a):z(a);return d?d:(d=b?v(a):w(a))?d:(d=b?B(a,c):C(a,c),d?d:D(a,b))}function F(a,b){var d,e,f=c.langData()._meridiemParse.test(a),g=f?"(\\d{1,2}):(\\d{2})\\s?([ap])m":"(\\d{1,2}):(\\d{2})",h=O.langConf().prefix,i=b?h.since+"|"+h.at:h.till,j=new RegExp(l("({0})\\s+{1}",i,g),"i");return a=P(a),d=a.originalValue.match(j),d&&d[2]?(a.labelBySubstr(d.index,d[0]),e=+d[2],"a"===d[4]?12===e&&(e=0):"p"===d[4]&&e>1&&12>e&&(e+=12),[e,+d[3]||0,0,0]):null}function G(a,b){switch(a){case"week":b*=7;case"day":b*=24;case"hour":b*=60;case"minute":return b}return null}function H(a){return new RegExp("(\\d+(\\.\\d+)?)"+a,"i")}function I(b,c,d){var e=O.langConf().alphaNum,f="^\\s*"+a.map(c,i).join("("+e+"){0,4}\\s+")+"("+e+"){0,4}\\s*$",g=new RegExp(f,"i");return a.find(b,function(a,b,c){return g.test("function"==typeof d?d(a,b,c):a)})}function J(){}function K(){}var L,M,N,O,P,Q,R,S,T="object"==typeof exports,U="extracted";return L=new f,O=d(g),O.fn=g.prototype,a.extend(O,{lang:function(a,b){c.lang(a,b);var d,f=O.fn;return a?b?L.set(a,b).abbr:(d=L.get(a),d||e(a),f._lang=d,f._lang.abbr):f._lang.abbr},langConf:function(){return O.fn._lang}}),M=d(m),a.extend(M.fn=m.prototype,{__isTextString:!0,toString:function(){return this._s},autocomplete:function(a){if(!this._s)return M(a);for(var b,c,d,e,f=k(this._s),g=f.map(function(a){return"("+i(a)+")"},this),h=g;h.length>0&&(b=h.join("\\s+"),c=new RegExp(b,"i"),!c.test(a));)h=h.slice(1);return e=f.length-h.length,e>0?(b=g.slice(0,e).join("\\s+"),c=new RegExp("^"+b,"i"),d=c.exec(this._s)[0],M(d+" "+a)):M(a)},words:function(){return k(this._s).map(M)}}),N=function(){var a=O.langConf();return a._stemmer=a._stemmer||new n(a.snowballAbbr),a._stemmer},a.extend(n.prototype,{__isStemmer:!0,stem:function(b){return a.isArray(b)?a.map(b,this.stem,this):(this._s.setCurrent(b),this._s.stem(),this._s.getCurrent())}}),P=function(a){return a&&a.__isLexicalInfo?a:new o(a)},a.extend(o.prototype,{__isLexicalInfo:!0,_setLabel:function(b,c){var d=this.labels[b];a.contains(d,c)||d.push(c)},_setLabels:function(a,b,c){for(var d=a;b>d;d++)this._setLabel(d,c)},labelBySubstr:function(a,b,c){var d=c?this.stemmedValue:this.originalValue,e=k(d.substring(0,a)).length,f=k(b).length;this._setLabels(e,e+f,U)},notLabeled:function(){var a,b=this,c=b.labels.length,d=[];for(a=0;c>a;a++)0===b.labels[a].length&&d.push(b.words[a]);return d}}),Q=d(q),a.extend(Q.fn=q.prototype,{__isDate:!0,week:function(){return p()},lastWeek:function(){return p(c().subtract("days",7))},nextWeek:function(){return p(c().add("days",7))}}),R=d(J),a.extend(R.fn=J.prototype,{__isExtractors:!0,estimation:function(b){function c(a,c){var d=b.originalValue.match(H(a));return d?(b.labelBySubstr(d.index,d[0]),G(c,parseFloat(d[1]))):0}b=P(b);var d=0;return a.each(O.langConf().estimation,function(a,b){return d+=c(a,b)}),d||null},date:function(a,b,c){var d=E(a,b,!!c),e=F(a,b);return e&&(d=d||new Date),d?(Date.prototype.setHours.apply(d,e||[0,0,0,0]),d):null},collection:function(a,b,c){a=P(a);var d,e,f,g=a.stems,h=g.length,i=[];for(e=0;h>e;e++)for(f=h;f>e;f--)if(d=I(b,g.slice(e,f),c)){i.push(d),a._setLabels(e,f,U),e=f-1;break}return i}}),S=d(K),a.extend(S.fn=K.prototype,{formatEstimation:function(b){var c,d,e=O.langConf().estimation;return!a.isNumber(b)||0>b?"":60>b?b+e.minute:(c=Math.floor(b/60),d=b-60*c,d>0?l("{0}{1} {2}{3}",c,e.hour,d,e.minute):c+e.hour)},guidHexColor:function(b){return a.isFunction(b.slice)?"#"+b.slice(4,7)+b.slice(-8,-5):null}}),a.extend(O,{text:M,stemmer:N,li:P,date:Q,extractors:R,utils:S}),O.lang("en",{snowballAbbr:"English",ranges:{"last week":O.date().lastWeek,"this week":O.date().week,"next week":O.date().nextWeek},relativeDays:["yesterday","today","tomorrow"],relativeDay:function(a){var b=this.relativeDays.indexOf(a);return-1===b?null:c().add("days",b-1).toDate()},prefix:{since:"since|from",at:"at|on",till:"till|until"},defaultDateRePattern:"\\d{1,2}[\\/]\\d{1,2}[\\/]\\d{4}",estimation:{week:"w",day:"d",hour:"h",minute:"m"},alphaNum:"[\\w\\d\\.]"}),O.lang("en"),O});